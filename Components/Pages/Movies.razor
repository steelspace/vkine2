@page "/movies"
@inject IMovieService MovieService
@rendermode InteractiveServer

<PageTitle>Virtualized Table</PageTitle>

@if (false) { }
else
{
    <div>
        <Virtualize ItemsProvider="@LoadMovies" Context="movie">
            <ItemContent>
                <div style="padding: 10px; border-bottom: 1px solid #ccc;">
                    <strong>@movie.Title</strong> - <img src="@movie.CoverUrl" alt="@movie.Title" width="100" />
                </div>
            </ItemContent>
            <Placeholder>
                <div style="padding: 10px; border-bottom: 1px solid #ccc;">
                    Loading...
                </div>
            </Placeholder>
        </Virtualize>
    </div>
}

@code {
    private async ValueTask<ItemsProviderResult<Movie>> LoadMovies(ItemsProviderRequest request)
    {
        var movies = await MovieService.GetMovies(request.StartIndex, request.Count);
        var totalCount = await MovieService.GetTotalMovieCount();
        return new ItemsProviderResult<Movie>(movies, totalCount);
    }
}
