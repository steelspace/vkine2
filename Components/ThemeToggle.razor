@inject IJSRuntime JSRuntime

<button type="button" class="theme-toggle" @onclick="Toggle" aria-label="Toggle color scheme" aria-pressed="@_isDark" title="Toggle color scheme">
    <svg class="icon icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="4"></circle>
        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" />
    </svg>
    <svg class="icon icon-system" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="9"></circle>
        <path d="M12 3v18" />
    </svg>
    <svg class="icon icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
    </svg>
</button>

@code {
    private bool _isDark;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                var applied = await JSRuntime.InvokeAsync<string>("eval",
                    "document.documentElement.getAttribute('data-theme') || 'light'");
                _isDark = string.Equals(applied, "dark", StringComparison.OrdinalIgnoreCase);
                StateHasChanged();
            }
            catch { }
        }
    }

    private async Task Toggle()
    {
        try
        {
            await JSRuntime.InvokeAsync<string>("vkineTheme.toggle");
        }
        catch
        {
            try
            {
                await JSRuntime.InvokeVoidAsync("eval",
                    @"(function(){var el=document.documentElement; el.setAttribute('data-theme', el.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');})();");
            }
            catch { }
        }
        finally
        {
            try
            {
                var applied = await JSRuntime.InvokeAsync<string>("eval",
                    "document.documentElement.getAttribute('data-theme') || 'light'");
                _isDark = string.Equals(applied, "dark", StringComparison.OrdinalIgnoreCase);
            }
            catch { }
        }
    }
}
